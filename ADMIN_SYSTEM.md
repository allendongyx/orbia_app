# 管理后台系统文档

## 概述

管理后台系统是一个专为具有管理员权限的用户设计的后台管理界面，提供了对平台用户、KOL、团队和订单的全面管理功能。

## 功能模块

### 1. 用户管理 (`/admin/users`)

#### 功能描述
管理平台上的所有用户账户，包括查看、搜索、禁用、删除和恢复用户，以及查看用户钱包信息。

#### 主要功能
- **用户列表展示**
  - 显示用户头像、昵称、邮箱/钱包地址
  - 显示用户角色（普通用户/管理员）
  - 显示用户状态（正常/已禁用/已删除）
  - 显示注册时间

- **搜索和筛选**
  - 关键字搜索：支持搜索用户名、邮箱、钱包地址
  - 角色筛选：所有角色、普通用户、管理员
  - 状态筛选：所有状态、正常、已禁用、已删除
  
- **用户操作**
  - 禁用用户：将正常用户设置为禁用状态，禁用后用户无法登录
  - 恢复用户：将已禁用的用户恢复为正常状态
  - 删除用户：将用户标记为已删除（不可逆操作）
  - 查看钱包：查看用户的钱包详细信息
  
- **钱包信息**
  - 可用余额
  - 冻结金额
  - 累计充值
  - 累计消费
  - 创建时间

- **权限保护**
  - 管理员用户不能被禁用或删除
  - 所有操作都需要确认

- **统计数据**
  - 总用户数
  - 正常用户数
  - 已禁用用户数
  - 管理员数量

#### 技术实现
- 使用 `getUsers` API 获取用户列表，支持分页和筛选
- 使用 `setUserStatus` API 修改用户状态
- 使用 `getUserWallet` API 获取用户钱包信息
- 使用对话框组件进行操作确认，避免误操作

### 2. KOL 管理 (`/admin/kols`)

#### 功能描述
审核和管理平台上的 KOL 申请，包括查看申请列表、审核通过或拒绝申请。

#### 主要功能
- **KOL 列表展示**
  - 显示 KOL 头像、显示名称
  - 显示关联的用户 ID
  - 显示国家信息
  - 显示粉丝数量
  - 显示申请状态（待审核/已通过/已拒绝）
  - 显示拒绝原因（如果被拒绝）
  - 显示申请时间

- **搜索和筛选**
  - 关键字搜索：支持搜索 KOL 名称、国家
  - 状态筛选：所有状态、待审核、已通过、已拒绝

- **审核操作**
  - 通过申请：批准 KOL 申请，用户即可在市场展示
  - 拒绝申请：拒绝 KOL 申请，需要填写拒绝原因
  - 查看详情：对于已通过的 KOL，可以查看其在市场的详情页

- **统计数据**
  - 总 KOL 数
  - 已通过数量
  - 待审核数量
  - 已拒绝数量

#### 技术实现
- 使用 `getKols` API 获取 KOL 列表
- 使用 `reviewKol` API 审核 KOL 申请
- 拒绝时必须填写原因，确保流程透明

### 3. 团队管理 (`/admin/teams`)

#### 功能描述
查看和管理平台上的所有团队，包括团队信息和成员列表。

#### 主要功能
- **团队列表展示**
  - 显示团队图标、名称
  - 显示创建者信息（名称和 ID）
  - 显示成员数量
  - 显示创建时间

- **搜索功能**
  - 关键字搜索：支持搜索团队名称

- **成员管理**
  - 查看团队成员列表
  - 显示成员头像、昵称、邮箱
  - 显示成员角色（创建者/所有者/普通成员）
  - 显示加入时间
  - 支持成员列表分页

- **统计数据**
  - 总团队数
  - 总成员数
  - 平均成员数

#### 技术实现
- 使用 `getTeams` API 获取团队列表
- 使用 `getTeamMembers` API 获取特定团队的成员列表
- 使用对话框展示团队成员详情，支持大量成员的分页展示

### 4. 订单管理 (`/admin/orders`)

#### 功能描述
查看和管理平台上的所有订单，包括订单状态和详细信息。

#### 主要功能
- **订单列表展示**
  - 显示订单 ID（唯一标识）
  - 显示用户信息（名称、邮箱/ID）
  - 显示 KOL 信息（名称和 ID）
  - 显示套餐名称
  - 显示订单金额
  - 显示订单状态
  - 显示创建时间和完成时间

- **搜索和筛选**
  - 关键字搜索：支持搜索订单 ID、用户名、邮箱、钱包地址
  - 状态筛选：待确认、已确认、进行中、已完成、已取消、已退款

- **订单状态说明**
  - **待确认 (pending)**：订单刚创建，等待确认
  - **已确认 (confirmed)**：订单已确认，准备开始
  - **进行中 (in_progress)**：订单正在执行中
  - **已完成 (completed)**：订单已完成
  - **已取消 (cancelled)**：订单已取消
  - **已退款 (refunded)**：订单已退款

- **统计数据**
  - 总订单数
  - 已完成订单数
  - 进行中订单数
  - 总金额统计

#### 技术实现
- 使用 `getOrders` API 获取订单列表
- 支持多种状态的筛选和搜索
- 使用不同颜色的徽章标识不同状态

## 共通功能

### 1. 权限控制
- 只有角色为 `admin` 的用户才能访问管理后台
- 在侧边栏中，管理功能菜单仅对管理员用户显示
- 所有管理 API 都需要管理员权限认证

### 2. 分页组件
- 可复用的分页组件 (`components/admin/pagination.tsx`)
- 显示当前页、总页数、总记录数
- 支持页码跳转
- 智能页码显示（当页数过多时显示省略号）

### 3. 搜索组件
- 可复用的搜索栏组件 (`components/admin/search-bar.tsx`)
- 支持回车搜索
- 统一的样式和交互

### 4. 数据展示
- 使用统计卡片展示关键指标
- 使用表格展示列表数据
- 使用徽章（Badge）标识状态
- 使用对话框进行详细信息展示和操作确认

### 5. 用户体验
- 加载状态提示
- 空状态提示
- 操作确认对话框（防止误操作）
- Toast 消息提示（成功/失败）
- 响应式设计（适配桌面和移动端）

## API 接口

所有管理后台接口都位于 `lib/api/admin.ts`，主要包括：

### 用户管理
- `getUsers(req)` - 获取用户列表
- `setUserStatus(req)` - 设置用户状态
- `getUserWallet(userId)` - 获取用户钱包信息

### KOL 管理
- `getKols(req)` - 获取 KOL 列表
- `reviewKol(req)` - 审核 KOL 申请

### 团队管理
- `getTeams(req)` - 获取团队列表
- `getTeamMembers(teamId, req)` - 获取团队成员列表

### 订单管理
- `getOrders(req)` - 获取订单列表

## 路由结构

```
/admin
├── /users          # 用户管理
├── /kols           # KOL 管理
├── /teams          # 团队管理
└── /orders         # 订单管理
```

## 导航结构

管理菜单在侧边栏中单独分组显示，包含：
- 管理用户 → 用户列表
- KOL 管理 → KOL 列表
- 团队管理 → 团队列表
- 订单管理 → 订单列表

## 设计规范

### 颜色系统
- **蓝色** - 主要信息、用户相关
- **绿色** - 成功、正常、已完成
- **黄色** - 待处理、待审核
- **红色** - 错误、拒绝、禁用
- **紫色** - 管理员、特殊角色
- **灰色** - 已删除、已取消

### 图标使用
- 使用 Lucide React 图标库
- 图标大小统一（小图标 h-3/w-3，中图标 h-4/w-4，大图标 h-5/w-5）
- 图标与文字配合使用，增强可读性

### 卡片和表格
- 使用 Radix UI 和 Tailwind CSS
- 统一的阴影和圆角
- hover 状态提供视觉反馈
- 表格行 hover 时背景变浅

## 注意事项

### 安全性
1. 所有操作都需要管理员权限验证
2. 敏感操作（禁用、删除、拒绝）需要确认
3. 管理员账户受保护，不能被禁用或删除
4. API 使用 JWT Bearer Token 认证

### 数据完整性
1. 拒绝 KOL 申请时必须填写原因
2. 所有列表操作支持搜索和筛选
3. 分页确保大数据量下的性能

### 用户体验
1. 加载状态明确提示
2. 操作结果即时反馈（Toast）
3. 空状态友好提示
4. 响应式布局适配不同屏幕

## 扩展建议

### 可能的改进
1. **导出功能** - 支持导出用户、订单等数据为 CSV/Excel
2. **批量操作** - 支持批量审核、批量禁用等操作
3. **数据可视化** - 添加图表展示统计数据趋势
4. **操作日志** - 记录管理员的所有操作，方便审计
5. **高级筛选** - 支持日期范围、多条件组合筛选
6. **实时通知** - 新申请、新订单的实时提醒

### API 优化建议
1. **响应格式统一** - 建议后端统一使用项目中的标准响应格式：
   ```typescript
   {
     data: {...},
     base_resp: { code: 0, message: "success" }
   }
   ```
   
2. **错误处理** - 增强错误信息的详细程度，便于前端展示

3. **权限细化** - 可以考虑更细粒度的权限控制（如只读管理员、超级管理员等）

## 文件结构

```
orbia_app/
├── app/
│   └── admin/
│       ├── users/page.tsx          # 用户管理页面
│       ├── kols/page.tsx           # KOL 管理页面
│       ├── teams/page.tsx          # 团队管理页面
│       └── orders/page.tsx         # 订单管理页面
├── components/
│   └── admin/
│       ├── pagination.tsx          # 分页组件
│       └── search-bar.tsx          # 搜索组件
├── lib/
│   ├── api/
│   │   └── admin.ts                # 管理后台 API
│   └── navigation-config.ts        # 导航配置（包含管理菜单）
└── ADMIN_SYSTEM.md                 # 本文档
```

## 总结

管理后台系统提供了完整的平台管理功能，通过友好的界面和完善的权限控制，使管理员能够高效地管理用户、KOL、团队和订单。系统采用组件化设计，代码复用度高，样式统一，易于维护和扩展。

